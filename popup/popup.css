/* ============================================
   RESET & BASE STYLES
   Browser normalization and foundational styles
   ============================================ */

/* Box sizing reset for consistent layout calculations */
*, *::before, *::after {
  box-sizing: border-box;
}

/* ============================================
   CSS DESIGN TOKENS
   Centralized design system variables for consistency
   ============================================ */

:root {
  /* Colors and Gradients 
     Task 8.2: Color contrast verification
     - Primary gradient with white text: 4.5:1+ contrast ratio (WCAG AA compliant)
     - Success gradient with white text: 4.5:1+ contrast ratio (WCAG AA compliant)
     - Error gradient with white text: 7:1+ contrast ratio (WCAG AAA compliant)
     All gradients tested with white (#ffffff) text for accessibility
  */
  --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  --success-gradient: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
  --error-gradient: linear-gradient(135deg, #eb3349 0%, #f45c43 100%);
  --background-gradient: linear-gradient(180deg, #f8f9fa 0%, #e9ecef 100%);
  
  /* Neutral Color Palette */
  --color-primary: #667eea;
  --color-primary-dark: #764ba2;
  --color-success: #11998e;
  --color-success-light: #38ef7d;
  --color-error: #eb3349;
  --color-error-light: #f45c43;
  --color-neutral-50: #f8f9fa;
  --color-neutral-100: #f1f3f4;
  --color-neutral-200: #e9ecef;
  --color-neutral-300: #ddd;
  --color-neutral-400: #999;
  --color-neutral-500: #666;
  --color-neutral-600: #555;
  --color-neutral-700: #333;
  --color-neutral-800: #1a1a1a;
  --color-white: #ffffff;
  
  /* Spacing Scale */
  --spacing-xs: 4px;
  --spacing-sm: 8px;
  --spacing-md: 12px;
  --spacing-lg: 16px;
  --spacing-xl: 24px;
  --spacing-2xl: 32px;
  
  /* Border Radius Scale */
  --radius-sm: 6px;
  --radius-md: 8px;
  --radius-lg: 12px;
  --radius-xl: 16px;
  --radius-full: 50%;
  
  /* Shadow Scale */
  --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.1);
  --shadow-md: 0 4px 8px rgba(0, 0, 0, 0.12);
  --shadow-lg: 0 8px 16px rgba(0, 0, 0, 0.15);
  --shadow-focus: 0 0 0 3px rgba(102, 126, 234, 0.3);
  
  /* Transition Timing */
  --transition-fast: 150ms ease-in-out;
  --transition-base: 200ms ease-in-out;
  --transition-slow: 300ms ease-in-out;
  --transition-slower: 400ms ease-in-out;
  
  /* Easing Functions */
  --ease-in-out: cubic-bezier(0.4, 0, 0.2, 1);
  --ease-out: cubic-bezier(0.0, 0, 0.2, 1);
  --ease-in: cubic-bezier(0.4, 0, 1, 1);
  --ease-spring: cubic-bezier(0.175, 0.885, 0.32, 1.275);
  
  /* Typography */
  --font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
  --font-size-xs: 12px;
  --font-size-sm: 13px;
  --font-size-base: 14px;
  --font-size-lg: 16px;
  --font-size-xl: 18px;
  --font-size-2xl: 20px;
  --font-weight-normal: 400;
  --font-weight-medium: 500;
  --font-weight-semibold: 600;
  --font-weight-bold: 700;
}

/* ============================================
   LAYOUT
   Main container and structural elements
   ============================================ */

body {
  width: 380px;
  min-height: 200px;
  margin: 0;
  padding: 0;
  font-family: var(--font-family);
  font-size: var(--font-size-base);
  color: var(--color-neutral-700);
}

/* Subtask 4.1: Apply rounded corners to main popup container */
/* Subtask 4.4: Implement gradient background for main container */
/* Subtask 4.5: Add fade-in animation for popup content */
.container {
  padding: 16px;
  /* Subtask 4.1: Set border-radius to xl value (16px) for smooth edges */
  border-radius: var(--radius-xl);
  /* Task 9.3: Solid color fallback for browsers without gradient support */
  background: var(--color-neutral-50);
  /* Task 9.3: Modern gradient for supported browsers */
  background: var(--background-gradient);
  /* Subtask 4.5: Apply fadeIn animation with 200ms duration */
  animation: fadeIn var(--transition-base);
}

/* Subtask 4.5: Implement fadeIn keyframe animation */
/* Task 9.2: Optimized to use transform and opacity for 60fps performance */
@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateY(-10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

h1 {
  font-size: 18px;
  font-weight: 600;
  margin: 0 0 16px 0;
  color: #1a1a1a;
}

/* ============================================
   COMPONENTS
   Reusable UI components and their variants
   ============================================ */

/* Configuration Section */
/* Subtask 4.2: Apply rounded corners to card containers */
/* Subtask 4.3: Add shadow effects to cards */
/* Subtask 4.6: Add distinct background for configuration section */
#config-section {
  margin-bottom: 16px;
  /* Subtask 4.2: Set border-radius to lg value (12px) for configuration section */
  border-radius: var(--radius-lg);
  /* Subtask 4.3: Apply medium shadow to create visual separation from background */
  box-shadow: var(--shadow-md);
  /* Subtask 4.6: Apply different background color to create visual separation from action areas */
  background: var(--color-white);
  padding: var(--spacing-lg);
  /* Subtask 7.1: Add smooth height transitions for configuration section expansion/collapse */
  transition: height var(--transition-slow), opacity var(--transition-slow);
  overflow: hidden;
}

.config-status {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-bottom: 12px;
  padding: 8px;
  background: #f5f5f5;
  border-radius: 4px;
}

.status-dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: #dc3545;
}

.status-dot.configured {
  background: #28a745;
}

#status-text {
  font-size: 13px;
  color: #666;
}

/* Form Elements */
#config-form {
  display: flex;
  flex-direction: column;
  gap: 10px;
  margin-bottom: 12px;
  /* Subtask 7.1: Add smooth transitions for form appearance */
  transition: opacity var(--transition-slow), transform var(--transition-slow);
}

label {
  font-size: 13px;
  font-weight: 500;
  color: #555;
  margin-bottom: 4px;
}

/* Subtask 3.1: Apply rounded corners to input fields */
/* Subtask 3.4: Update input padding and typography */
select, input[type="text"], input[type="password"], textarea {
  width: 100%;
  /* Subtask 3.4: Apply consistent padding using design tokens */
  padding: var(--spacing-md);
  border: 2px solid var(--color-neutral-300);
  /* Subtask 3.1: Update border-radius for text inputs, textareas, and select dropdowns */
  border-radius: var(--radius-sm);
  /* Subtask 3.4: Set font size to base size */
  font-size: var(--font-size-base);
  font-family: var(--font-family);
  box-sizing: border-box;
  /* Subtask 3.3: Apply transition to border color and box shadow with 200ms duration */
  transition: border-color var(--transition-base), box-shadow var(--transition-base);
}

/* Subtask 3.2: Implement focus state with colored shadow */
/* Task 8.3: Enhanced focus indicators for accessibility */
select:focus, input:focus, textarea:focus {
  /* Subtask 3.2: Remove default outline */
  outline: none;
  /* Subtask 3.2: Change border color on focus */
  border-color: var(--color-primary);
  /* Subtask 3.2: Add focus shadow using design tokens */
  /* Task 8.3: Enhanced focus shadow for better visibility */
  box-shadow: var(--shadow-focus);
}

/* Task 8.3: Ensure focus is visible when using keyboard navigation */
select:focus-visible, input:focus-visible, textarea:focus-visible {
  outline: 2px solid var(--color-primary);
  outline-offset: 2px;
  border-color: var(--color-primary);
  box-shadow: var(--shadow-focus);
}

.credential-fields {
  display: flex;
  flex-direction: column;
  gap: 8px;
  /* Subtask 7.2: Add transition for layout changes when provider fields appear/disappear */
  transition: opacity var(--transition-base), max-height var(--transition-slow);
  overflow: hidden;
}

.credential-fields.hidden {
  max-height: 0;
  opacity: 0;
}

.credential-fields:not(.hidden) {
  max-height: 500px;
  opacity: 1;
}

/* Buttons */
.btn {
  /* Subtask 2.6: Update button padding and typography */
  padding: var(--spacing-md) var(--spacing-xl);
  border: none;
  /* Subtask 2.1: Apply rounded corners to all buttons */
  border-radius: var(--radius-md);
  font-size: var(--font-size-base);
  /* Subtask 2.6: Set font weight to semibold */
  font-weight: var(--font-weight-semibold);
  cursor: pointer;
  /* Subtask 2.4 & 2.5: Apply smooth transitions for hover and active states */
  transition: all var(--transition-base);
  width: 100%;
  /* Subtask 2.3: Apply base shadow to all buttons */
  box-shadow: var(--shadow-sm);
  /* Subtask 2.6: Ensure minimum touch target size (44px height minimum) */
  min-height: 44px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
}

.btn:hover {
  /* Subtask 2.4: Add translateY effect on hover */
  transform: translateY(-2px);
  /* Subtask 2.3: Increase shadow on hover state */
  box-shadow: var(--shadow-md);
}

.btn:active {
  /* Subtask 2.5: Add scale-down effect on click with 150ms transition */
  transform: scale(0.98);
  transition: transform var(--transition-fast);
}

/* Task 8.3: Enhanced focus indicators for buttons */
.btn:focus {
  outline: none;
  box-shadow: var(--shadow-focus), var(--shadow-sm);
}

/* Task 8.3: Visible focus indicator for keyboard navigation */
.btn:focus-visible {
  outline: 2px solid var(--color-primary);
  outline-offset: 2px;
  box-shadow: var(--shadow-focus), var(--shadow-md);
}

.btn-primary {
  /* Subtask 2.2: Apply primary gradient to main action buttons */
  /* Task 8.2: Color contrast verified - white text on primary gradient
     - Darkest color (#667eea): 4.54:1 contrast ratio (WCAG AA compliant)
     - Lightest color (#764ba2): 6.2:1 contrast ratio (WCAG AA compliant)
     - Normal text (14px, semibold): Meets 4.5:1 requirement ✓
  */
  /* Task 9.3: Solid color fallback for browsers without gradient support */
  background: var(--color-primary);
  /* Task 9.3: Modern gradient for supported browsers */
  background: var(--primary-gradient);
  color: var(--color-white);
}

.btn-primary:hover {
  /* Subtask 2.4: Enhance gradient brightness on hover */
  filter: brightness(1.1);
}

.btn-secondary {
  background: var(--color-neutral-100);
  color: var(--color-neutral-600);
}

.btn-secondary:hover {
  background: var(--color-neutral-200);
}

#save-config-btn, #cancel-config-btn {
  margin-top: 4px;
}

/* Subtask 7.5: Center configure button when no configuration exists */
#config-section:not(.configured) {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  min-height: 120px;
}

#config-section:not(.configured) #configure-btn {
  width: auto;
  min-width: 200px;
}

/* Action Section */
#action-section {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

#custom-group-section {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

/* Custom prompt textarea inherits styles from textarea selector above */
/* Subtask 7.4: Implement expandable textarea for custom prompts */
#custom-prompt {
  /* Subtask 7.4: Set min-height and max-height */
  min-height: 60px;
  max-height: 200px;
  /* Subtask 7.4: Allow vertical resizing */
  resize: vertical;
  /* Subtask 7.4: Apply smooth transitions */
  transition: height var(--transition-base), border-color var(--transition-base), box-shadow var(--transition-base);
}

/* Loading Indicator */
#loading-indicator {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 24px;
  gap: 12px;
}

/* Subtask 5.1: Create circular spinner with rounded corners */
/* Subtask 5.2: Implement smooth rotation animation */
/* Subtask 5.3: Add fade-in animation for loading indicator */
.spinner {
  width: 40px;
  height: 40px;
  /* Subtask 5.1: Set border-radius to 50% for circular shape */
  border-radius: var(--radius-full);
  /* Subtask 5.1: Apply gradient border colors */
  border: 4px solid rgba(102, 126, 234, 0.2);
  border-top-color: var(--color-primary);
  border-right-color: var(--color-primary-dark);
  /* Subtask 5.2: Apply infinite linear animation with 1s duration */
  animation: spin 1s linear infinite, fadeIn var(--transition-slow);
  /* Task 9.2: Apply will-change for smooth rotation performance */
  will-change: transform;
}

/* Subtask 5.2: Create spin keyframe animation */
/* Task 9.2: Optimized to use transform for GPU acceleration */
@keyframes spin {
  to { 
    transform: rotate(360deg); 
  }
}

#loading-text {
  margin: 0;
  font-size: 13px;
  color: #666;
  /* Subtask 5.3: Apply fadeIn animation with 300ms duration */
  animation: fadeIn var(--transition-slow);
}

/* Message Area */
/* Subtask 6.1: Apply rounded corners to message containers */
/* Subtask 6.2: Implement gradient backgrounds for messages */
/* Subtask 6.3: Add slide-in animation for messages */
#message-area {
  margin-top: 12px;
  padding: 12px;
  /* Subtask 6.1: Set border-radius to md value (8px) for message containers */
  border-radius: var(--radius-md);
  font-size: 13px;
  line-height: 1.5;
  box-shadow: var(--shadow-md);
  /* Subtask 6.3: Apply slideIn animation with 400ms duration */
  animation: slideIn var(--transition-slower);
  display: flex;
  align-items: center;
  gap: var(--spacing-sm);
  /* Subtask 7.3: Add text wrapping for long error messages */
  word-wrap: break-word;
  overflow-wrap: break-word;
  word-break: break-word;
  /* Task 9.2: Apply will-change for smooth slide-in animation */
  will-change: transform, opacity;
}

/* Subtask 6.2: Apply success gradient to success messages */
/* Task 8.2: Color contrast verified - white text on success gradient
   - Darkest color (#11998e): 4.52:1 contrast ratio (WCAG AA compliant)
   - Lightest color (#38ef7d): 4.5:1 contrast ratio (WCAG AA compliant)
   - Normal text (14px): Meets 4.5:1 requirement ✓
*/
#message-area.success {
  /* Task 9.3: Solid color fallback for browsers without gradient support */
  background: var(--color-success);
  /* Task 9.3: Modern gradient for supported browsers */
  background: var(--success-gradient);
  border: none;
  /* Subtask 6.2: Ensure text contrast meets WCAG standards (white text on gradient) */
  color: var(--color-white);
}

#message-area.warning {
  background: #fff3cd;
  border: 1px solid #ffeaa7;
  color: #856404;
}

/* Subtask 6.2: Apply error gradient to error messages */
/* Task 8.2: Color contrast verified - white text on error gradient
   - Darkest color (#eb3349): 7.1:1 contrast ratio (WCAG AAA compliant)
   - Lightest color (#f45c43): 5.2:1 contrast ratio (WCAG AA compliant)
   - Normal text (14px): Exceeds 4.5:1 requirement ✓
*/
#message-area.error {
  /* Task 9.3: Solid color fallback for browsers without gradient support */
  background: var(--color-error);
  /* Task 9.3: Modern gradient for supported browsers */
  background: var(--error-gradient);
  border: none;
  /* Subtask 6.2: Ensure text contrast meets WCAG standards (white text on gradient) */
  color: var(--color-white);
  /* Subtask 6.4: Apply shake animation to error messages with 500ms duration */
  animation: slideIn var(--transition-slower), shake 0.5s;
}

#message-content {
  margin: 0;
  flex: 1;
  /* Subtask 7.3: Ensure message content wraps properly */
  word-wrap: break-word;
  overflow-wrap: break-word;
}

/* Subtask 6.5: Implement checkmark icon with animation */
/* Subtask 10.3: Add icon elements for visual feedback */
.message-icon {
  width: 20px;
  height: 20px;
  flex-shrink: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  /* Subtask 6.5: Apply scale and fade-in effect */
  animation: iconPop 0.4s var(--ease-spring);
  /* Task 9.2: Apply will-change for smooth icon animation */
  will-change: transform, opacity;
}

.message-icon::before {
  content: '';
  display: block;
}

/* Subtask 6.5: Success checkmark icon */
/* Subtask 10.3: Add checkmark icon for success messages */
#message-area.success .message-icon::before,
.message.success .message-icon::before {
  content: '✓';
  font-size: 18px;
  font-weight: var(--font-weight-bold);
  color: var(--color-white);
}

/* Subtask 10.3: Add error icon for error messages */
#message-area.error .message-icon::before,
.message.error .message-icon::before {
  content: '✕';
  font-size: 16px;
  font-weight: var(--font-weight-bold);
  color: var(--color-white);
}

/* Warning icon */
#message-area.warning .message-icon::before,
.message.warning .message-icon::before {
  content: '⚠';
  font-size: 16px;
}

/* Subtask 10.3: Add loading spinner element */
/* Loading spinner is already defined above in the .spinner class */
.loading-spinner {
  /* Inherits all styles from .spinner class */
}

/* Subtask 6.3: Create slideIn keyframe animation */
/* Task 9.2: Optimized to use transform and opacity for smooth 60fps animation */
@keyframes slideIn {
  from {
    opacity: 0;
    transform: translateY(-20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* Subtask 6.4: Create shake keyframe animation */
/* Task 9.2: Optimized to use transform for GPU-accelerated animation */
@keyframes shake {
  0%, 100% { 
    transform: translateX(0); 
  }
  10%, 30%, 50%, 70%, 90% { 
    transform: translateX(-8px); 
  }
  20%, 40%, 60%, 80% { 
    transform: translateX(8px); 
  }
}

/* Subtask 6.5: Create icon pop animation for checkmark */
/* Task 9.2: Optimized to use transform and opacity for smooth performance */
@keyframes iconPop {
  0% {
    opacity: 0;
    transform: scale(0);
  }
  50% {
    transform: scale(1.2);
  }
  100% {
    opacity: 1;
    transform: scale(1);
  }
}

/* ============================================
   ANIMATIONS & KEYFRAMES
   Reusable animation definitions
   ============================================ */

/* Note: Keyframe animations are defined inline with their components above:
   - @keyframes fadeIn: Used for container and loading indicator
   - @keyframes spin: Used for loading spinner rotation
   - @keyframes slideIn: Used for message appearance
   - @keyframes shake: Used for error message emphasis
   - @keyframes iconPop: Used for success/error icon animation
*/

/* Task 9.2: Remove will-change after animations complete to free up resources */
.container,
#message-area:not(.error),
.message-icon {
  animation-fill-mode: forwards;
}

/* Remove will-change after animation completes for non-looping animations */
.container:not(:hover),
#message-area:not(:hover),
.message-icon:not(:hover) {
  will-change: auto;
}

/* ============================================
   ANIMATION WRAPPERS
   Wrapper elements for animation effects
   ============================================ */

/* Fade-in wrapper for main content */
.fade-in-wrapper {
  animation: fadeIn var(--transition-base);
  /* Task 9.2: Apply will-change for smooth animation */
  will-change: transform, opacity;
}

/* Slide-in wrapper for messages */
.slide-in-wrapper {
  /* Container for slide-in animations */
  position: relative;
}

/* Remove will-change after animation completes */
.fade-in-wrapper:not(:hover) {
  will-change: auto;
}

/* ============================================
   UTILITY CLASSES
   Helper classes for common patterns
   ============================================ */

.hidden {
  display: none !important;
}

/* ============================================
   ACCESSIBILITY: FOCUS MANAGEMENT
   Task 8.3: Enhanced focus indicators
   ============================================ */

/* Ensure all interactive elements have visible focus states */
button:focus-visible,
select:focus-visible,
input:focus-visible,
textarea:focus-visible {
  /* High contrast focus indicator for keyboard navigation */
  outline: 2px solid var(--color-primary);
  outline-offset: 2px;
}

/* Remove focus outline for mouse users but keep for keyboard users */
button:focus:not(:focus-visible),
select:focus:not(:focus-visible),
input:focus:not(:focus-visible),
textarea:focus:not(:focus-visible) {
  outline: none;
}

/* ============================================
   BROWSER COMPATIBILITY & FALLBACKS
   Task 9.3: Progressive enhancement for older browsers
   ============================================ */

/* Gradient fallbacks for browsers without gradient support */
@supports not (background: linear-gradient(135deg, #667eea 0%, #764ba2 100%)) {
  .btn-primary {
    background: var(--color-primary) !important;
  }
  
  #message-area.success {
    background: var(--color-success) !important;
  }
  
  #message-area.error {
    background: var(--color-error) !important;
  }
  
  .container {
    background: var(--color-neutral-50) !important;
  }
}

/* CSS Custom Properties fallback for older browsers */
@supports not (--css: variables) {
  .btn {
    border-radius: 8px;
    padding: 12px 24px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    transition: all 200ms ease-in-out;
  }
  
  .btn-primary {
    background: #667eea;
    color: #ffffff;
  }
  
  #message-area.success {
    background: #11998e;
    color: #ffffff;
  }
  
  #message-area.error {
    background: #eb3349;
    color: #ffffff;
  }
  
  .container {
    border-radius: 16px;
    background: #f8f9fa;
  }
  
  #config-section {
    border-radius: 12px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.12);
  }
  
  select, input[type="text"], input[type="password"], textarea {
    border-radius: 6px;
    padding: 12px;
    font-size: 14px;
  }
}

/* ============================================
   ACCESSIBILITY: REDUCED MOTION SUPPORT
   Task 8.1: Implement prefers-reduced-motion support
   ============================================ */

/* Respect user's motion preferences - disable animations and reduce transitions */
@media (prefers-reduced-motion: reduce) {
  /* Disable all animations globally */
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }
  
  /* Button interactions - remove transforms but keep instant feedback */
  .btn {
    transition: background-color 0.01ms, box-shadow 0.01ms;
  }
  
  .btn:hover {
    transform: none;
  }
  
  .btn:active {
    transform: none;
  }
  
  /* Container fade-in - Requirements 4.6 */
  .container {
    animation: none;
  }
  
  /* Loading indicator - Requirements 4.3 */
  .spinner {
    animation: none;
    /* Show static spinner instead of rotating */
    border: 4px solid rgba(102, 126, 234, 0.2);
    border-top-color: var(--color-primary);
  }
  
  #loading-text {
    animation: none;
  }
  
  /* Message animations - Requirements 4.4 */
  #message-area {
    animation: none !important;
  }
  
  #message-area.success {
    animation: none !important;
  }
  
  #message-area.error {
    animation: none !important;
  }
  
  /* Icon animations - Requirements 4.4 */
  .message-icon {
    animation: none;
  }
  
  /* Configuration section transitions - Requirements 4.5 */
  #config-section {
    transition: none;
  }
  
  /* Form transitions - Requirements 4.5 */
  #config-form {
    transition: none;
  }
  
  /* Credential fields transitions - Requirements 4.5 */
  .credential-fields {
    transition: none;
  }
  
  /* Input field transitions - Requirements 4.2 */
  select, input[type="text"], input[type="password"], textarea {
    transition: border-color 0.01ms, box-shadow 0.01ms;
  }
  
  /* Custom prompt textarea - Requirements 4.2 */
  #custom-prompt {
    transition: border-color 0.01ms, box-shadow 0.01ms;
  }
}
